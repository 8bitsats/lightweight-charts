<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Area Chart Example</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }
        
        #chart-container {
            position: relative;
            width: 800px;
            height: 400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        #tooltip-container {
            position: absolute;
            display: none;
            padding: 8px;
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
    </style>
</head>
<body>
    <h1>Area Chart with Custom Tooltip</h1>
    <div id="chart-container">
        <div id="tooltip-container"></div>
    </div>

    <script type="module">
        // Import the createChart function from the local build
        import { createChart } from './dist/lightweight-charts.standalone.development.mjs';

        // Get DOM elements
        const chartContainer = document.getElementById('chart-container');
        const tooltipContainer = document.getElementById('tooltip-container');

        // Create the chart
        const chart = createChart(chartContainer, {
            width: 800,
            height: 400,
            layout: {
                background: { color: '#ffffff' },
                textColor: '#333',
            },
            grid: {
                vertLines: { color: '#f0f0f0' },
                horzLines: { color: '#f0f0f0' },
            },
            rightPriceScale: {
                borderColor: '#dfdfdf',
            },
            timeScale: {
                borderColor: '#dfdfdf',
                timeVisible: true,
                secondsVisible: false,
            },
            crosshair: {
                horzLine: {
                    visible: true,
                    labelVisible: true,
                },
                vertLine: {
                    visible: true,
                    labelVisible: true,
                },
            },
        });

        // Create an area series
        const areaSeries = chart.addAreaSeries({
            topColor: 'rgba(33, 150, 243, 0.56)',
            bottomColor: 'rgba(33, 150, 243, 0.04)',
            lineColor: 'rgba(33, 150, 243, 1)',
            lineWidth: 2,
        });

        // Generate some sample data
        const data = [];
        const startDate = new Date('2023-01-01').getTime();
        const dayMs = 24 * 60 * 60 * 1000;
        
        for (let i = 0; i < 60; i++) {
            const time = new Date(startDate + i * dayMs);
            const formattedTime = time.toISOString().split('T')[0]; // YYYY-MM-DD format
            
            // Generate a value with some randomness but following a trend
            const baseValue = 50 + i * 0.5; // Upward trend
            const randomFactor = Math.random() * 10 - 5; // Random fluctuation between -5 and 5
            const value = baseValue + randomFactor;
            
            data.push({
                time: formattedTime,
                value: value,
            });
        }

        // Set the data
        areaSeries.setData(data);

        // Fit the chart to the data
        chart.timeScale().fitContent();

        // Custom tooltip handling
        chart.subscribeCrosshairMove(param => {
            if (param.point === undefined || !param.time || param.point.x < 0 || param.point.y < 0) {
                tooltipContainer.style.display = 'none';
                return;
            }

            const areaData = param.seriesData.get(areaSeries);
            if (!areaData) {
                return;
            }

            const date = new Date(param.time);
            const formattedDate = date.toLocaleDateString('en-US', {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });

            tooltipContainer.innerHTML = `
                <div>Date: ${formattedDate}</div>
                <div>Value: ${areaData.value.toFixed(2)}</div>
            `;

            const coordinate = areaSeries.priceToCoordinate(areaData.value);
            const shiftX = 10;
            const shiftY = 10;
            
            // Position the tooltip
            const chartRect = chartContainer.getBoundingClientRect();
            const tooltipWidth = tooltipContainer.offsetWidth;
            const tooltipHeight = tooltipContainer.offsetHeight;
            
            let left = param.point.x + shiftX;
            let top = coordinate - tooltipHeight - shiftY;
            
            // Make sure the tooltip stays inside the chart container
            if (left + tooltipWidth > chartRect.width) {
                left = param.point.x - tooltipWidth - shiftX;
            }
            
            if (top < 0) {
                top = coordinate + shiftY;
            }
            
            tooltipContainer.style.left = left + 'px';
            tooltipContainer.style.top = top + 'px';
            tooltipContainer.style.display = 'block';
        });

        // Hide the tooltip when the mouse leaves the chart
        chartContainer.addEventListener('mouseleave', () => {
            tooltipContainer.style.display = 'none';
        });
    </script>
</body>
</html> 